<%- include('../partials/head', {title: "Havenboards - Editing Product"}) %>
  <body>
  <%- include('../partials/header') %>

    <main>
      <div class="top-section">
        <section class="top-promotion">
          <article class="top-promotion-img">
            <img src="/images/panoramic/login4.jpg" alt="Foto para login" />
          </article>
        </section>
      </div>
      <div class="content">
        <h1 class="logo">Edición de Producto</h1>
        <div class="contact-wrapper">
          <div class="contact-form">

            <!-- seteamos el form para que pueda recibir imágenes y le damos la ruta que tomará al mandarse -->
            <form action="/products/<%= editProduct.id %>?_method=PUT" method="POST" enctype="multipart/form-data">

              <p>
                <label for="name">Nombre del Producto*</label>
                <input
                  type="text"
                  name="name"
                  id="name"
                  required
                  pattern="([^\s][A-z0-9À-ž\s]+)"
                  class="<%= locals.errors && errors.name ? 'is-invalid' : null %>"
                  value="<%= editProduct.name %>"
                />
                <% if (locals.errors && errors.name) { %>
                  <label class="infovalidacion">
                    <%= errors.name.msg %>
                  </label>
                <% } %>
              </p>

              <p>
                <label for="description">Descripción</label>
                <textarea
                  type="text" name="description"
                  id="description" pattern="([^\s][A-z0-9À-ž\s]+)"
                  required
                  class="<%= locals.errors && errors.description ? 'is-invalid' : null %>"
                  value="<%= locals.oldData && oldData.description ? oldData.description : null%>"/
                  >
                  <%= editProduct.description %>
                </textarea>
                <% if (locals.errors && errors.description) { %>
                  <label class="infovalidacion">
                    <%= errors.description.msg %>
                  </label>
                <% } %>
              </p>

              <p>
                <label for="imagen">Ingrese una o más imágenes</label>
                <input type="file" name="image" multiple 
                class="<%= locals.errors && errors.image ? 'is-invalid' : null %>"
                />

                <span class="img-edit-product-container">
                  <% for (let i = 0; i < editProduct.image.length; i++) { %>
                  <span class="img-edit-product-box">
                        <img class="img-edit-product" src="/images/tall/<%= editProduct.image[i]%>" alt="foto producto <%= editProduct.name %>"/>
                  </span>
                  <% } %>
                </span> 
                <% if (locals.errors && errors.image) { %>
                  <label class="infovalidacion">
                    <%= errors.image.msg %>
                  </label>
                <% } %> 
              </p>

              <p>
                <label for="category">Categoría*</label>
                <select
                  name="category"
                  id="category"
                  required
                >
                <!-- comprobamos en cada uno de los option si el valor de la categoría es la que se va a mostrar. Si es así, preseleccionarla para que aparezca directamente -->
                <% const categories = ["Snowboarding", "Skateboarding", "Surf", "Wakeboarding", "Accessory"] %>

                <% for (const oneCategory of categories) { %>
                  <option value="<%=oneCategory%>" <%= editProduct.category === oneCategory ? 'selected':"" %>><%= oneCategory %></option>
                <% } %>
                </select>
                <% if (locals.errors && errors.category) { %>
                  <label class="infovalidacion">
                    <%= errors.category.msg %>
                  </label>
                <% } %>
              </p>

              <p>
                <label for="subcategory">Subcategoría</label>
                <select
                  name="subcategory"
                  id="subcategory" 
                >

                <% const subcategories = ["Helmet", "Gloves", "Protection", "Fin", "Wax", "Glasses"] %>

                  <option value="" <%= editProduct.subcategory === null ? 'selected':"" %>>Ninguna</option>

                  <% for (const oneSubcategory of subcategories) { %>
                    <option value="<%=oneSubcategory %>" <%= editProduct.subcategory === oneSubcategory ? 'selected':"" %>><%= oneSubcategory%></option>
                  <% } %>
                  
                </select>
                <% if (locals.errors && errors.subcategory) { %>
                  <label class="infovalidacion">
                    <%= errors.subcategory.msg %>
                  </label>
                <% } %>
              </p>

              <p>
                <label for="brand">Marca*</label>
                <select
                  name="brand"
                  id="brand"
                  required
                >
                <% const brands = ["Quicksilver", "Billabong", "Roxy", "Patagonia", "Hurley", "Burton"] %> 
                <!-- comprobamos en cada uno de los option si el valor de la marca es la que se va a mostrar. Si es así, preseleccionarla para que aparezca directamente -->
                <% for (const oneBrand of brands) { %>
                  <option value="<%= oneBrand %>" <%= editProduct.brand ===  oneBrand ? 'selected':"" %>><%= oneBrand %></option>
                <% } %>
                </select>
                <% if (locals.errors && errors.brand) { %>
                  <label class="infovalidacion">
                    <%= errors.brand.msg %>
                  </label>
                <% } %>
              </p>

              <p>
                <label for="price">Precio*</label>
                <input type="number" name="price" id="price" value="<%= editProduct.price %>"
                required
                class="<%= locals.errors && errors.price ? 'is-invalid' : null %>" />
                <% if (locals.errors && errors.price) { %>
                  <label class="infovalidacion">
                    <%= errors.price.msg %>
                  </label>
                <% } %>
              </p>

              <p>
                <label for="discount">Ingrese descuento*</label>
                <input type="number" name="discount" 
                required value="<%= editProduct.discount %>" id="discount"
                class="<%= locals.errors && errors.discount ? 'is-invalid' : null %>"  />
                <% if (locals.errors && errors.discount) { %>
                  <label class="infovalidacion">
                    <%= errors.discount.msg %>
                  </label>
                <% } %>
              </p>

              <p>
                <label for="sale">En rebajas*</label>
                <select
                  name="sale"
                  id="sale"
                  required
                >
                <!-- poner un if discount distinto 0? -->
                  <option value="1" <%= editProduct.sale == true ? 'selected':"" %>>Sí</option>
                  <option value="0">  <%= editProduct.sale == false ? 'selected':"" %>>No</option>
                </select>
                <% if (locals.errors && errors.sale) { %>
                  <label class="infovalidacion">
                    <%= errors.sale.msg %>
                  </label>
                <% } %>
              </p>

              <p>
                <label for="size">Talle*</label>
                <select
                  name="size"
                  id="size"
                >
                  <option value="" <%= editProduct.size === null? 'selected':"" %>>Talle único</option>
                  <option value="S" <%= editProduct.size === "S"? 'selected':"" %>>S</option>
                  <option value="M" <%= editProduct.size === "M"? 'selected':"" %>>M</option>
                  <option value="L" <%= editProduct.size === "L"? 'selected':"" %>>L</option>
                </select>
                <% if (locals.errors && errors.size) { %>
                  <label class="infovalidacion">
                    <%= errors.size.msg %>
                  </label>
                <% } %>
              </p>

              <p class="block">
                <button type="submit">Editar Producto</button>
              </p>
            </form>

            <!-- hacemos otro form para poder dar ruta al botón que nos llevará a eliminar este producto -->
            <form class="delete-form"
                action="/products/<%= editProduct.id %>?_method=DELETE"
                method="POST">
                <button type="submit" class="button-delete">
                  ELIMINAR
                </button>
            </form>
          </div>
        </div>
      </div>
    </main>

    <%- include('../partials/footer') %>
  </body>
</html>
